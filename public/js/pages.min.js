"use strict";$(document).ready(function(){$(".alert.selectable").on("click",function(){$(this).fadeOut()}),$(".question .continue").on("click","a",function(a){var b=$(this),c=b.closest(".continue"),d=c.find("input[type='submit']");c.is(".disabled")?a.preventDefault():b.is(".done")&&d.size()>0&&(a.preventDefault(),d.click())}),$(".question.multi-step").each(function(){var a=function(){var a=$(".puzzle"),b=a.size(),c=function(){var a=window.location.hash||"#";return/step-[0-9]+/.test(a)?a:a+(a.length>1?"-":"")+"step-1"}(),d=parseInt(/step-([0-9]+)/.exec(c)[1],10),e=a.filter(".active"),f=a.eq(d-1);e.fadeOut(function(){$(this).toggleClass("active inactive")}),f.hide().toggleClass("active inactive").fadeIn().find(".progress-tracker").triggerHandler("change"),$(".next").attr("href",c.replace(/step-[0-9]+/,"step-"+(d===b?1:d+1)))};window.onhashchange=a,a()}),$(".question-1").each(function(){$(this).droppable({scope:"items",drop:function(a,b){var c=$(b.draggable),d=c.closest(".product"),e=d.data("zIndex")||0;d.data("zIndex",e+=1),c.css({zIndex:e}).removeClass("drag").find("input").prop("checked",!1).triggerHandler("change")}}),$(".product .caption").droppable({scope:"items",hoverClass:"indicator",tolerance:"fit",greedy:!0,drop:function(a,b){{var c=$(b.draggable);c.closest(".product")}c.removeClass("drag").siblings().has("input:checked").css({left:"",top:""}),c.find("input").prop("checked",!0).triggerHandler("change")}}),$(".price").draggable({revert:"invalid",scope:"items",containment:".question-1",start:function(){var a=$(this);a.addClass("drag").css({zIndex:999})}}).find("input").change(function(){var a=$(this),b=a.closest(".product"),c=$(".product"),d=$(".continue").not(".disabled"),e=b.find("input:checked").size()>0,f=c.find("input:checked").size()===c.size();$(".done").toggleClass("hidden",!f),$(".next").toggleClass("hidden",f),d!==e&&(e?$(".continue").removeClass("hidden disabled").fadeIn():$(".continue").addClass("disabled").fadeOut(function(){$(this).addClass("hidden")}))}).triggerHandler("change"),$(window).resize(function(){var a=$(".puzzle.active").find(".caption"),b=a.offset();b.left+=Math.floor(.33*a.width()),b.top+=Math.floor(.4*a.height()),$(".puzzle").each(function(){$(this).find(".price").each(function(){var a=$(this);a.has("input:checked").size()?(a.addClass("drag"),a.offset(b),a.offset(b),a.removeClass("drag")):a.css({left:"",top:""})})})}).resize()}),$(".question-2").each(function(){$(".choice input").change(function(){var a=$(this).closest(".approach"),b=$(".approach"),c=$(".continue").not(".disabled"),d=a.find("input:checked").size()>0,e=b.find("input:checked").size()===b.size();$(".done").toggleClass("hidden",!e),$(".next").toggleClass("hidden",e),c!==d&&(d?$(".continue").removeClass("hidden disabled").fadeIn():$(".continue").addClass("disabled").fadeOut(function(){$(this).addClass("hidden")}))}).triggerHandler("change")}),$(".question-3").each(function(){function a(){var a="#"+d3.select(this).attr("id");d3.select(a+" .bg").style("fill","#db0029")}function b(){d3.select("#yes .bg").style("fill","#999999"),d3.select("#no .bg").style("fill","#999999")}function c(a){function b(){d3.selectAll(".stamp-marking svg").transition().duration(100).style("opacity","0"),d3.select(".continue").transition().duration(400).style("opacity","0").each("end",function(){d3.select(".continue").style("opacity","1"),$(".continue").addClass("hidden"),$("a.done").addClass("hidden"),$("a.next").addClass("hidden")})}var c,d,e;if(!g){g=!0,a?(c=$(".stamp-marking.yes"),d=d3.select(".stamp-marking.yes svg")):(c=$(".stamp-marking.no"),d=d3.select(".stamp-marking.no svg"));var f=.1*c.width()+.4*c.width()*Math.random(),h=.02*c.height()+.2*c.width()*Math.random();d.style("left",f+"px"),d.style("top",h+"px"),d3.selectAll(".stamp-marking svg").style("opacity","0"),$(".stampable.active input").eq(a).prop("checked",!0).triggerHandler("change"),$("a.next").on("click",b),d.transition().duration(600).ease("bounce").style("height","40%").style("width","40%").style("opacity","1").each("end",function(){g=!1,e=$(".stampable.active").index()+1===$(".stampables .stampable").length,e?($(".continue").removeClass("hidden"),$("a.done").removeClass("hidden"),$("a.next").addClass("hidden")):($(".continue").removeClass("hidden"),$("a.done").addClass("hidden"),$("a.next").removeClass("hidden"))})}}function d(){$(".stampable input").change(function(){d3.selectAll(".stamp-marking svg").style("opacity","0"),$(this).is(":checked")&&c(this.value===String(1)?!0:!1),$(this).hasClass("no")&&$(this).next().is(":checked")&&c(!0)})}function e(){$(".stamps").load("img/q3.stamps.svg",null,function(){d3.select(".stamps #yes").on("mouseover",a).on("mouseout",b).on("click",function(){$(".stampable.active input").eq(0).prop("checked",!1).triggerHandler("change"),$(".stampable.active input").eq(1).prop("checked",!0).triggerHandler("change")}),d3.select(".stamps #no").on("mouseover",a).on("mouseout",b).on("click",function(){$(".stampable.active input").eq(0).prop("checked",!0).triggerHandler("change"),$(".stampable.active input").eq(1).prop("checked",!1).triggerHandler("change")}),$("#yes, #no").bind("click",function(){b()})})}function f(){$(".yesno .yes").load("img/q3.yes.svg",null,function(){$(".stampable.active input.yes").is(":checked")&&setTimeout(function(){c(!0)},500)}),$(".yesno .no").load("img/q3.no.svg",null,function(){$(".stampable.active input.no").is(":checked")&&setTimeout(function(){c(!1)},500)})}var g=!1;e(),f(),d(),$(window).resize(function(){$(".stampable input:checked").triggerHandler("change")})}),$(".question-4").each(function(){$(this).droppable({scope:"items",drop:function(a,b){var c=$(b.draggable);c.removeClass("drag").find("input").prop("checked",!1).triggerHandler("change")}}),$(".card").draggable({revert:"invalid",scope:"items",containment:".question-4",start:function(){var a=$(this),b=$(".answers"),c=b.data("zIndex")+1||1;b.data("zIndex",c),a.addClass("drag").css({zIndex:c})}}).find("input").change(function(){var a=$(this),b=a.closest(".card"),c=b.find("input:checked").val();if("string"==typeof c){var d=$('.answer[data-value="'+c+'"]'),e=d.offset();e.left+=Math.floor((d.width()-b.width())/2),e.top+=Math.floor((d.height()-b.height())/2),b.offset(e),b.offset(e),b.removeClass("drag")}var f=$(".card"),g=$(".continue").not(".disabled"),h=f.find("input:checked").size()===f.size();g!==h&&(h?$(".continue").removeClass("hidden disabled").fadeIn():$(".continue").addClass("disabled").fadeOut(function(){$(this).addClass("hidden")}))}),$(".answer").droppable({scope:"items",hoverClass:"indicator",greedy:!0,drop:function(a,b){var c=$(this),d=$(b.draggable);d.removeClass("drag").find('input[value="'+c.data("value")+'"]').prop("checked",!0).triggerHandler("change")}}),$(window).resize(function(){var a=$(".cards"),b=a.width(),c=a.height(),d=0;a.find(".card").each(function(){var a=$(this),e=parseInt(a.css("zIndex"),10),f=a.find("input:checked");f.size()?(a.addClass("drag").offset({top:0,left:0}).css({zIndex:e||(d+=1)}),f.triggerHandler("change")):a.css({top:Math.floor(Math.random()*c),left:Math.floor(Math.random()*b)})}),d&&$(".answers").data("zIndex",d)}).resize()}),$(".question-5").each(function(){function a(a){d3.select(".q5-svg.bodies g.body-"+a).classed("selectable",!0).on("click",function(){$(".continue").addClass("hidden"),e(a)})}function b(){$(".q5-svg.bodies").append($("<div/>").addClass("frame")),$(".q5-svg.bodies .frame").load("img/q5.bodies.svg",null,function(){for(var b=0;5>b;b+=1)a(b)})}function c(){var a=$(".q5-svg.speech-bubble-corners");a.append($("<div/>").addClass("frame")),a=a.find(".frame");for(var b=0;5>b;b+=1)a.append($("<div/>").load("img/q5.corner"+b+".svg"))}function d(){var a=.64*$(".q5-svg.speech-bubble-corners").height();d3.select(".q5-svg.speech-bubble .frame").style("bottom",a+"px");var b=$(".q5-svg.bodies .frame").width(),c=.79*b,d=(b-c)/2;d3.select(".q5-svg.speech-bubble .frame").style("width",c+"px").style("left",d+"px"),$("body").width()<960?d3.select(".q5-svg.speech-bubble .frame").style("border-width","1px"):d3.select(".q5-svg.speech-bubble .frame").style("border-width","3px")}function e(a){g===a?(d3.select(".q5-svg.thumbs-up svg").transition().duration(200).style("opacity",0),d3.select(".q5-svg.bubbles").transition().duration(500).style("opacity",0),d3.select(".context").transition().duration(500).style("opacity",1),g=-1):(d3.selectAll(".turns-red").transition().duration(200).style("fill","#FFFFFF"),d3.select(".q5-svg.thumbs-up .inner-frame .hover").transition().duration(200).style("opacity",0),d3.select(".context").transition().duration(500).style("opacity",.2),d3.select(".q5-svg.bubbles").transition().duration(500).style("opacity",0).each("end",function(){d3.select(".q5-svg.speech-bubble").html(""),d3.select(".q5-svg.thumbs-up svg").transition().duration(200).style("opacity",1),i=!1,h=!1,d3.selectAll(".q5-svg.speech-bubble-corners .corner").style("opacity",0),d3.select(".q5-svg.speech-bubble-corners .corner-"+a).style("opacity",1);var b=$("#q5a_"+(a+1)+" .text").html();d3.select(".q5-svg.speech-bubble").append("div").attr("class","frame").append("div").attr("class","speech-bubble-text note emphasis invert").html(b),d3.select(".q5-svg.bubbles").transition().duration(500).style("opacity",1),d(),g=a})),$(window).resize(function(){d()})}function f(){$(".thumbs-up").load("img/q5.thumbsUp.svg",null,function(){d3.select(".thumbs-up").classed("selectable",!0).on("click",function(){h=!h,h?(d3.selectAll(".turns-red").transition().duration(200).style("fill","#db0029"),$(".continue").removeClass("hidden"),$(".advice input").prop("checked",!1).triggerHandler("change"),$(".advice input#advice-"+(g+1)).prop("checked",!0).triggerHandler("change")):(d3.selectAll(".turns-red").transition().duration(200).style("fill","#FFFFFF"),$(".continue").addClass("hidden"))}),d3.select(".thumbs-up").on("mouseover",function(){i||d3.select(".thumbs-up .hover").transition().duration(200).style("opacity",1),i=!0}),d3.select(".thumbs-up").on("mouseout",function(){i=!1,h||d3.select(".thumbs-up .hover").transition().duration(200).style("opacity",0)})})}var g,h=!1,i=!1;c(),b(),f()}),$(".question-6").each(function(){function a(a,b){var c=a-$("#q6-arrow").width()/2,d=.9*$("#q6-arrow").height()-b;0>d&&(d=0);var e=Math.atan2(d,c)-Math.PI/2;return e*=-57.2957795,t>e&&(e=t),e>s&&(e=s),e}function b(){var a=parseFloat(d3.select("#q6-arrow svg").attr("width").replace("px",""),10),b=parseFloat(d3.select("#q6-arrow svg").attr("height").replace("px",""),10);return{x:a/2,y:.9*b}}function c(){v||(u=!0,r=!0,q=!0,$(".continue").addClass("hidden").fadeOut(),$("a.next").addClass("hidden").fadeOut(),d3.selectAll(".light-6").transition().duration(400).attr("r",d3.select(".light-5").attr("r")),m.transition().duration(800).ease("bounce").attrTween("transform",h).each("end",function(){w.x=0,w.y=0,p=0,u=!1}),$(".question-6 .true").removeClass("highlight"),$(".question-6 .false").removeClass("highlight"))}function d(a){$(".question-6 ."+a).addClass("highlight")}function e(a){$(".question-6 ."+a).removeClass("highlight")}function f(){v=!1,d3.selectAll(".light-6").transition().duration(400).attr("r",d3.select(".light-5").attr("r")),$(".question-6 .true").removeClass("highlight"),$(".question-6 .false").removeClass("highlight")}function g(){var c,e;u||($(".statement.active input").prop("checked",!1).triggerHandler("change"),f(),o=b(),d3.select(".centroid").style("left",o.x+"px").style("top",o.y+"px"),p=a(d3.event.x,d3.event.y),m.attr("transform","rotate("+p+","+o.x+", "+o.y+")"),p>=s&&(x=!0,d3.select(".light-true.light-6").transition().duration(200).attr("r",80).style("fill","#ffffff"),d("true")),t>=p&&(x=!0,d3.select(".light-false.light-6").transition().duration(200).attr("r",80),d("false")),(t>=p||p>=s)&&q&&(v=!0,c=p>=s,$(".statement.active input").eq(c).prop("checked",!0).triggerHandler("change"),$(".continue").removeClass("hidden"),e=$(".statement.active").index()+1===$(".statements .statement").length,$("a.done").toggleClass("hidden",!e),$("a.next").toggleClass("hidden",e)))}function h(){return d3.interpolateString("rotate("+p+","+o.x+","+o.x+")","rotate(0,"+o.x+", "+o.x+")")}function i(){return d3.interpolateString("rotate("+p+","+o.x+","+o.x+")","rotate("+t+","+o.x+", "+o.x+")")}function j(){return d3.interpolateString("rotate("+p+","+o.x+","+o.x+")","rotate("+s+","+o.x+", "+o.x+")")}function k(){$(".statement input").change(function(){if($(this).is(":checked")){f();var a,b,c,g;this.value===String(1)?(a=j,b=s,c="true",g="false"):(a=i,b=t,c="false",g="true"),m.transition().duration(800).ease("bounce").attrTween("transform",a).each("end",function(){p=b}),d3.select(".light-"+c+".light-6").transition().duration(800).attr("r",80).style("fill","#ffffff"),d(c),e(g),x=!0,v=!0,$(".continue").removeClass("hidden");var h=$(".statement.active").index()+1===$(".statements .statement").length;$("a.done").toggleClass("hidden",!h),$("a.next").toggleClass("hidden",h)}})}var l,m,n,o,p,q=!0,r=!1,s=77.4,t=-79.9,u=!1,v=!1,w={x:0,y:0},x=!1;$("a.next").on("click",function(){f(),c()}),l=d3.behavior.drag(),l.on("drag",g),l.on("dragend",c);var y=function(a){a.call(l),a.on("click",function(){$(".statement.active input").prop("checked",!1).triggerHandler("change"),f(),c()})},z=function(a){var b=d3.select(".true-false ."+a+" span");b.on("click",function(){$(".statement.active input").eq(a).prop("checked",!0).triggerHandler("change"),$(".statement.active input").eq(!a).prop("checked",!1).triggerHandler("change")})},A=function(){y(m),y(d3.select("#q6-arrow svg")),p=0,o=b(),z(!1),z(!0),k()};$(".question-6 .dial").load("img/q6.dial.svg",null,function(){$(".question-6 .arrow").load("img/q6.arrow.svg",null,function(){m=d3.select(".arrow path"),n=d3.select(".arrow svg"),$(".question-6 .cap").load("img/q6.cap.svg",null,function(){$(".question-6 .lights").load("img/q6.lights.svg",null,function(){d3.selectAll(".light-6").style("fill","#ffffff"),b(),A()})})})})}),$(".question-7").each(function(){function a(a){var b=a.x>=i.x0,c=a.x<=i.x1,d=a.y>=i.y0,e=a.y<=i.y1;return b&&c&&d&&e}function b(a){var b=parseInt($("html").css("font-size").replace("px",""),10),c=$("#svg-frame").width(),d=$("#svg-frame").height(),e=.05*c,f=25*b,k=f,l=(c-f)/2,n=.3*d,p=.5*d,r=.25*d,s=r/j;k+n>d&&(n=3*b),d3.selectAll(".trash").style("right",e+"px").style("top",p+"px").style("width",s+"px").style("height",r+"px");for(var t,u,v=0,w=750,x=!m[0],y=0;q>y;y+=1){var z=x?y+1:y;"undefined"!=typeof $("#postit-frame-"+m[z])[0]&&(0===z?d3.select("#postit-frame-"+m[z]).classed("selectable",!1).style("z-index","").transition().duration(w).style("top",n+"px").style("left",l+"px").each("end",function(){d3.select(this).classed("draggable",!0)}):a&&a===m[z]||(t=v%2?-50:10,u=Math.floor(22*b*.33*v-50),d3.select("#postit-frame-"+m[z]).classed("selectable",!0).classed("draggable",!1).style("z-index",v+=1).transition().duration(w).style("left",t+"px").style("top",u+"px")))}g={x:l+f/2,y:n+k/2},i={x0:c-e-s,y0:p,x1:c-e,y1:p+r},h={x:c-e-s/2,y:p+r/2};var A=Math.pow(h.x-g.x,2),B=Math.pow(h.y-g.y,2),C=Math.sqrt(A+B);o.domain([C,C/3])}function c(a){if(m[0]){if(a!==m[0]){for(var c in m)if(m.hasOwnProperty(c)){var d=m[c];if(d===a){m[c]=m[0],m[0]=d;break}}b(a)}}else{d3.select(".context").transition().duration(500).style("opacity",.2);for(var c in m)if(m.hasOwnProperty(c)){var d=m[c];d===a?m[0]=d:d>a&&(m[c-1]=m[c])}b()}}function d(){d3.selectAll(".postit-frame").call(f),$(".postit-frame").on("click",function(){var a=parseInt(this.id.replace("postit-frame-",""),10);c(a)}),$(".postit-frame").on({touchstart:function(){var a=parseInt(this.id.replace("postit-frame-",""),10);c(a)}})}function e(){$(".trash").load("img/q7.basket.svg",null,function(){d3.selectAll(".trash svg .paper").style("opacity","0"),d3.select(".trash svg #paper").style("opacity","1")})}var f,g,h,i,j=302.013/352.814,k=0,l=[!1,!1,!1,!1,!1],m={},n=!1,o=d3.scale.linear();o.rangeRound([0,2]).clamp();var p=!1;f=d3.behavior.drag(),f.on("drag",function(){var c=parseInt(this.id.replace("postit-frame-",""),10);if(c===m[0]){var d=parseInt($(this).css("left").replace("px",""),10),e=parseInt($(this).css("top").replace("px",""),10),f=$(this).width(),i=$(this).height(),j=d+d3.event.dx,l=e+d3.event.dy;-f/2>j&&(j=-f/2),j>$("body").width()-f/2&&(j=$("body").width()-f/2),-i/2>l&&(l=-i/2),l>$("body").height()-i/2&&(l=$("body").height()-i/2),d3.select(this).style("top",l+"px").style("left",j+"px"),g={x:j+f/2,y:l+i/2};var p=Math.pow(h.x-g.x,2),q=Math.pow(h.y-g.y,2),r=Math.sqrt(p+q),s=o(r);s=Math.max(s,0),d3.select(this).classed("crumpled-1",1===s),d3.select(this).classed("crumpled-2",s>1),a(g)&&4>k?(d3.selectAll(".trash svg .change-color").style("fill","#db0029"),n=!0):k>=4?(d3.selectAll(".trash svg .change-color").style("fill","#999999"),n=!1,b()):(d3.selectAll(".trash svg .change-color").style("fill","#999999"),n=!1)}}),f.on("dragend",function(){if(d3.selectAll(".trash svg .change-color").style("fill","#999999"),n){$("#postit-frame-"+m[0]).remove(),k+=1,d3.select(".trash svg #paper-"+k).style("opacity","1"),n=!1,l[m[0]-1]=!0,p=k===$(".postit").length-1,p&&($(".postit input").prop("checked",!1).triggerHandler("change"),$(".postit input#list-"+m[0]).prop("checked",!0).triggerHandler("change"),$(".continue").hide(),$(".continue").removeClass("hidden"),$(".continue").fadeIn(),$(".trash").fadeOut());for(var a=0;q-1>a;a+=1)m[a]=m[a+1];m[q-1]=-1}else d3.select(this).classed("crumpled-1",!1),d3.select(this).classed("crumpled-2",!1);b()});var q=$(".postit").length;e();for(var r=1;q>=r;r+=1)m[r]=r;b(),d(),$(window).resize(function(){b()})}),$(".question-8").each(function(){function a(){var a=$(".pie-chart").width()/2,b=$(".pie-chart").height()/2;return{x:a,y:b}}function b(){var b=d3.select(".pie-chart .knob");b.style("width","42px"),b.style("height","43px"),w={left:a().x-s*Math.sin(x)-s/8,top:a().y-s*Math.cos(x)-s/8},b.style("left",w.left+"px"),b.style("top",w.top+"px")}function c(){x=-1*H(O),b()}function d(){function c(){for(var b=1;5>=b;b+=1)f=d3.select("#svg-frame .option-"+b),g=a().y,h=a().x,g-=1.3*s*Math.cos(H(b)),h+=1.3*s*Math.sin(H(b)),i=$("#svg-frame .option-"+b).width(),j=$("#svg-frame .option-"+b).height(),h-=i/2,g-=j/2,f.style("top",g+"px"),f.style("left",h+"px"),O===b&&$(f[0]).addClass("active")}function d(){A=$("#svg-frame").find(".bar-chart").width(),B=$("#svg-frame").find(".bar-chart").height(),C.range([0,A]),D.rangeRoundBands([0,.7*B],.2),y.attr("width",A).attr("height",B),z.attr("transform","translate("+.1*A+", 20)");var a=parseInt($(".label").css("font-size").replace("px",""),10);F.attr("x",function(a){return C(a.value)+10}).attr("y",function(b,c){return D(c)+1.05*a}),G.attr("x",10).attr("y",function(b,c){return D(c)+1.05*a}),E.attr("x",function(a){return C(Math.min(0,a.value))}).attr("y",function(a,b){return D(b)}).attr("width",function(a){return Math.abs(C(a.value))}).attr("height",D.rangeBand())}function e(){q=$("#svg-frame").width()/2,r=$("#svg-frame").height()/2,q=.67*Math.min(q,r),r=q,s=q/2,o=$(".context").offset().left+$(".context").width()/2-q/2,p=.48*$("#svg-frame").height(),d3.select("#svg-frame .pie-chart").style({width:q+"px",height:q+"px",left:o+"px",top:p+"px"}),m.attr("width",q).attr("height",r),n.attr("transform","translate("+s+","+s+")"),t.transition().duration(0).attrTween("d",function(a){var b=d3.interpolate(this._current,a),c=d3.interpolate(l.outerRadius()(),s);return this._current=b(0),function(a){return l.innerRadius(0).outerRadius(c(a))(b(a))}});var a=d3.selectAll("#svg-frame .pie-chart .ring svg g"),b=1.01*s/J.width,c=q/2-b*J.width;a.attr("transform","translate("+c+", 1) scale("+2*b+") ")}var f,g,h,i,j;e(),d(),c(),x=H(O),b()}function e(){for(var a=0;a<L.length;a+=1){var b="option"+a;N[b]=[];for(var c=0;c<L[a].length;c+=1)N[b].push({value:L[a][c]})}}function f(){A=$("#svg-frame").find(".bar-chart").width(),B=$("#svg-frame").find(".bar-chart").height(),C=d3.scale.linear().domain([0,100]),D=d3.scale.ordinal().domain([0,1,2,3,4]).rangeRoundBands([0,.8*B],.2),y=d3.select("#svg-frame .bar-chart").append("svg"),z=y.append("g"),E=z.selectAll(".bar").data(N[M]).enter().append("rect").attr("class",function(){return"bar"}).style("fill",function(a,b){return K(b)}).attr("width",function(a){return Math.abs(C(a.value))}).attr("height",D.rangeBand()),F=z.selectAll(".label").data(N[M]).enter().append("text").attr("class","label emphasis invert note").text(function(a,b){return $("#share-text-"+(b+1)+" span").text().toUpperCase()}),G=z.selectAll(".percentages").data(N[M]).enter().append("text").attr("class","label emphasis invert note").text(function(a){return a.value+"%"})}function g(a){var b=d3.interpolate(this._current,a);return this._current=b(0),function(a){return l(b(a))}}function h(a){u.append("div").attr("class","option caption emphasis invert selectable option-"+a).on("click",function(){M="option"+(a-1),O=a,k.value(function(a){return a.value}),t=t.data(k(N[M])),t.transition().duration(750).attrTween("d",g),E.data(N[M]).transition().duration(750).attr("width",function(a){return Math.abs(C(a.value))}),F.data(N[M]).transition().duration(750).attr("x",function(a){return C(a.value)+10}),G.data(N[M]).transition().duration(750).text(function(a){return a.value+"%"}),$("#svg-frame .option").removeClass("active"),$("#svg-frame .option-"+O).addClass("active"),c()}).text(a)}function i(){q=$("#svg-frame").width()/2,r=$("#svg-frame").height()/2,q=.6*Math.min(q,r),r=q,s=q/2,o=$(".context").offset().left+$(".context").width()/2-q/2,p=.35*$("#svg-frame").height(),k=d3.layout.pie().sort(null).value(function(a){return a.value}),l=d3.svg.arc().innerRadius(0).outerRadius(s),m=d3.select("#svg-frame .pie-chart").append("svg"),n=m.append("g"),t=n.selectAll("path").data(k(N[M])).enter().append("path").attr("fill",function(a,b){return K(b)}).attr("d",l).each(function(a){this._current=a}),$("#svg-frame .pie-chart").append($("<div/>").addClass("ring")),$("#svg-frame .pie-chart .ring").load("img/q8.ring.svg",null,function(){d3.select("#svg-frame .pie-chart .ring");d()}),$("#svg-frame .pie-chart").append($("<div/>").addClass("knob")),$("#svg-frame .pie-chart .knob").load("img/q8.knob.svg",null,function(){var e=d3.select("#svg-frame .pie-chart .knob");e.classed("draggable",!0),d(),v=d3.behavior.drag();var f;v.on("dragstart",function(){f={x:0,y:0}}),v.on("drag",function(){var c={x:d3.event.x-a().x,y:a().y-d3.event.y},d=Math.atan2(c.y,c.x);d-=Math.PI/2,x=d,b(),d-=Math.PI/8,d+=2*Math.PI,d%=2*Math.PI,O=Math.floor(I(d)),O!==P&&(M="option"+(O-1),P=O,k.value(function(a){return a.value}),t=t.data(k(N[M])),t.transition().duration(750).attrTween("d",g),E.data(N[M]).transition().duration(750).attr("width",function(a){return Math.abs(C(a.value))}),F.data(N[M]).transition().duration(750).attr("x",function(a){return C(a.value)+10}),G.data(N[M]).transition().duration(750).text(function(a){return a.value+"%"}),$("#svg-frame .option").removeClass("active"),$("#svg-frame .option-"+O).addClass("active"))}),v.on("dragend",function(){c()}),e.call(v)}),u=d3.select("#svg-frame .options");for(var e=1;5>=e;e+=1)h(e)}function j(){$(".continue a").click(function(){$(".share input").prop("checked",!1).triggerHandler("change"),$(".share input#share-"+O).prop("checked",!0).triggerHandler("change")})}var k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H=d3.scale.linear().domain([1,6]).range([0,2*Math.PI]),I=d3.scale.linear().domain([2*Math.PI,0]).range([1,6]),J={width:760,height:760},K=d3.scale.ordinal().range(["#c3c75c","#97d4d2","#e8e5d5","#ff8a6c","#848484"]),L=[[30,25,20,15,10],[23,40,17,12,8],[18,33,10,25,14],[12,8,35,25,20],[23,12,22,18,25]],M="option0",N={},O=1,P=1;e(),f(),i(),j(),$(window).resize(function(){d()})}),$(".calculation").each(function(){$(".banner").click(function(a){$(this).is(".working")&&a.preventDefault()}).toggleClass("working inactive").append($("<b/>").addClass("percentage").css({width:0})).find(".text").hide(),$(".percentage").animate({width:"100%"},1800,"linear",function(){$(this).remove(),$(".banner").removeClass("working").find(".text").fadeIn()})}),$(".result").each(function(){$(".comparison").find(".label").each(function(){var a,b,c,d,e=parseInt($(this).text(),10),f=[{value:e},{value:100-e}];a=d3.select(".chart").append("svg:svg").data([f]).attr("width","100%").attr("height","100%").attr("viewBox","0 0 50 50").append("svg:g").attr("transform","translate(25, 25)"),c=d3.svg.arc().outerRadius(20),b=d3.layout.pie().value(function(a){return a.value}),d=a.selectAll("g.slice").data(b).enter().append("svg:g").attr("class","slice"),d.append("svg:path").attr("transform",function(a,b){return 0===b?"rotate(90) scale(1.15, 1.15)":"rotate(90)"}).attr("fill",function(a,b){return 0===b?"#db0029":"#999999"}).attr("d",c)})})});