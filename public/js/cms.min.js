
// public/js/jquery.cookie.min.js
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){function b(a){return h.raw?a:encodeURIComponent(a)}function c(a){return h.raw?a:decodeURIComponent(a)}function d(a){return b(h.json?JSON.stringify(a):String(a))}function e(a){0===a.indexOf('"')&&(a=a.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{a=decodeURIComponent(a.replace(g," "))}catch(b){return}try{return h.json?JSON.parse(a):a}catch(b){}}function f(b,c){var d=h.raw?b:e(b);return a.isFunction(c)?c(d):d}var g=/\+/g,h=a.cookie=function(e,g,i){if(void 0!==g&&!a.isFunction(g)){if(i=a.extend({},h.defaults,i),"number"==typeof i.expires){var j=i.expires,k=i.expires=new Date;k.setDate(k.getDate()+j)}return document.cookie=[b(e),"=",d(g),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("")}for(var l=e?void 0:{},m=document.cookie?document.cookie.split("; "):[],n=0,o=m.length;o>n;n++){var p=m[n].split("="),q=c(p.shift()),r=p.join("=");if(e&&e===q){l=f(r,g);break}e||void 0===(r=f(r))||(l[q]=r)}return l};h.defaults={},a.removeCookie=function(b,c){return void 0!==a.cookie(b)?(a.cookie(b,"",a.extend({},c,{expires:-1})),!0):!1}});;

// public/js/jquery.iframe-post-form.min.js
!function(a){a.fn.iframePostForm=function(b){var c,d,e,f,g=!0;return b=a.extend({},a.fn.iframePostForm.defaults,b),a("#"+b.iframeID).length||a("body").append('<iframe id="'+b.iframeID+'" name="'+b.iframeID+'" style="display:none" />'),a(this).each(function(){e=a(this),e.attr("target",b.iframeID),e.submit(function(){return g=b.post.apply(this),g===!1?g:void(f=a("#"+b.iframeID).load(function(){c=f.contents().find("body"),d=b.json?a.parseJSON(c.text()):c.html(),b.complete.apply(this,[d]),f.unbind("load"),setTimeout(function(){c.html("")},1)}))})})},a.fn.iframePostForm.defaults={iframeID:"iframe-post-form",json:!1,post:function(){},complete:function(){}}}(jQuery);;

// public/js/admin.min.js
var timeoutHandler=function(a,b){if("error"===b){var c="object"==typeof a?JSON.stringify(a):a;c&&-1===c.indexOf("Not authorized")?window.location.reload():window.location.href="/login/timeout"}},ElementSelector={currentElement:null,newVersions:{},createElementVersion:function(a){a=$(a);var b=a.attr("data-id");b&&$.ajax({url:"/admin/create-pageelement-version",type:"post",data:{id:b},success:function(){$(".page-element").load("/admin/page-element-form",{id:b},timeoutHandler)},error:timeoutHandler})},createAppVersion:function(){$.ajax({url:"/admin/create-app-version",type:"post",data:{tag:$("#tagName").val()},success:function(){window.location.href="/cms"},error:timeoutHandler})},restoreVersion:function(a,b){a=$(a);var c=a.attr("data-id");c&&$.ajax({url:"/admin/restore-pageelement-version",type:"post",data:{id:c,version:b},success:function(d,e){"OK"===d.status?($(ElementSelector.currentElement).replaceWith($(d.html).addClass("active")),ElementSelector.currentElement=$(".app .element.active"),$(a).removeClass("error"),$(".page-element").load("/admin/page-element-form",{id:c},function(){$('[data-id="'+b+'"]').addClass("active")})):($(a).addClass("error"),timeoutHandler(d,e))},error:timeoutHandler})},selectElement:function(a){ElementSelector.currentElement=$('.app .element[data-id="'+a+'"]'),$(".element").removeClass("active").filter('[data-id="'+a+'"]').addClass("active"),$(".page-element").load("/admin/page-element-form",{id:a},timeoutHandler)},changeValue:function(a,b,c,d){a.data("last-save")!==a.val()&&(a.data("last-save",a.val()),$.ajax({url:"/admin/save-property-value",type:"post",data:{value:c,id:b,newVersion:ElementSelector.newVersions[a.prop("name")]},dataType:"json",success:function(b,c){"OK"===b.status?(d.replaceWith($(b.html).addClass("active")),ElementSelector.currentElement=$(".app .element.active"),a.removeClass("error").data("last-save",a.val()),$("#version-elements a.restore-version.active").removeClass("active")):(a.addClass("error"),timeoutHandler(b,c))},error:timeoutHandler}),ElementSelector.newVersions[a.prop("name")]=!1)}};$(document).ready(function(){if($(".sections.header .table-of-contents a").each(function(){-1!==location.pathname.indexOf($(this).attr("href"))&&$(this).parents("li").addClass("selected")}),$(document).on("click",".newVersion",function(){null!==ElementSelector.currentElement&&ElementSelector.createElementVersion(ElementSelector.currentElement)}),function(a){var b=location.pathname.split("/")[1]||"cms",c=JSON.parse($.cookie(a)||"{}"),d=c[b];$(".cms.toolbox .group").each(function(a){d&&$(this).toggleClass("collapsed",1!==d[a])}),$(".cms.toolbox").on("click",".group-header a",function(b){b.preventDefault();var c=location.pathname.split("/")[1]||"cms",d=JSON.parse($.cookie(a)||"{}");$(this).closest(".group").toggleClass("collapsed"),d[c]=[],$(".cms.toolbox .group").each(function(){d[c].push($(this).is(".collapsed")?0:1)}),$.cookie(a,JSON.stringify(d),{path:"/"})})}("cms.toolbox.groups"),$(".app").on("click","[href]",function(a){a.preventDefault()}),$(document).on("click",".element",function(a){a.preventDefault();var b=$(this),c=b.attr("data-id");if($("#toolbox-elements").find('[data-id="'+c+'"]').size()){if(b.parents("#toolbox-elements").size()){var d=$(".app"),e={top:$(".cms.header").height(),bottom:$(window).height()},f=d.find('[data-id="'+c+'"]'),g=f.offset().top,h=g+f.height(),i=d.height()/4;(g<e.top||h>e.bottom)&&(f[0].scrollIntoView(!0),f.offset().top<e.top+i&&d.scrollTop(d.scrollTop()-i))}ElementSelector.selectElement(c)}}),$("#toolbox-elements .element").length>0&&ElementSelector.selectElement($("#toolbox-elements .element").first().attr("data-id")),$(document).on("focus",".page-element-property input, .page-element-property textarea",function(){ElementSelector.newVersions[$(this).prop("name")]=!0}),$(document).on("click",".app-version-restore",function(){if(!confirm("Do you want to restore this snapshot?"))return!1;var a=$(this).attr("data-id");return $.ajax({url:"/admin/restore-app-version",type:"post",data:{id:a,pages:$("input#restorePages").prop("checked"),settings:$("input#restoreSettings").prop("checked"),brandings:$("input#restoreBrandings").prop("checked")},success:function(a,b){"OK"==a.status?window.location.reload():timeoutHandler(a,b)},error:timeoutHandler}),!1}),$(".autosave").each(function(){var a=$(this);a.data("last-save",a.val())}),$(document).on("blur",".page-element-property input, .page-element-property textarea",function(){ElementSelector.changeValue($(this),$(this).attr("data-id"),$(this).val(),$(".app .element.active"))}),$(".cms.settings, .cms.ci").each(function(){$(document).on("blur",".autosave",function(){var a=$(this);a.data("last-save")!==a.val()&&(a.data("last-save",a.val()),$.ajax({url:location.pathname+("/"===location.pathname.slice(-1)?"":"/")+"save",type:"post",data:{name:a.attr("name"),value:a.val()},dataType:"json",success:function(b,c){"OK"==b.status?(a.removeClass("error"),$(".cms.ci").each(function(){$("#brandingcss").attr("href","/css/branding.css?time="+(new Date).getTime())}),"undefined"!=typeof b.value&&(a.val(b.value),a.data("last-save",b.value))):(a.addClass("error"),timeoutHandler(b,c))},error:timeoutHandler}))}),$(this).is(".ci")&&$(".upload").on("change",function(){var a=$(this);if(a.val()){var b=a.parents("form");b.iframePostForm({iframeID:b.find("iframe").attr("id"),json:!0,complete:function(b){var c;"OK"===b.status&&(c=b.value,a.next(".preview").find("img").attr("src",c),$("#company img").attr("src",c))}}).submit()}})}),$(document).on("click",".action.change-password",function(){window.location.href="/cms/change-password"}),$(document).on("click",".create-app-version",function(){return ElementSelector.createAppVersion(),!1}),$(document).on("click",".restore-version",function(a){return a.preventDefault(),ElementSelector.restoreVersion(ElementSelector.currentElement,$(this).closest("li").attr("data-id")),!1}),-1!==location.pathname.indexOf("/cms")&&location.search){var a={user:"Password",live:"Application status",reset:"Database"},b=location.search.slice(1).split("-"),c=a[b[0]],d="OK"!==b[1],e=$(".segment."+b[0]);c&&(e.append($("<div/>").addClass("attention").addClass(d?"failure":"success").text(c+(d?" has not been updated.":" has been updated."))),e.find(".attention").append($("<div/>").addClass("highlight")),e.find(".highlight").fadeOut(2e3))}$(document).on("click",".action[data-request]",function(){var a=$(this).data("request");return a.confirm&&!confirm(a.confirm)?!1:($.ajax({url:a.url,type:"post",success:function(b){a.redirect&&(window.location.href=a.redirect.replace(/@/,b.status))},error:function(b,c){a.redirect?window.location.href=a.redirect.replace(/@/,"ERR"):timeoutHandler(b,c)}}),!1)}),$(document).on("click",".version-item .remove",function(){return confirm("Do you really want to remove this version?")?($.ajax({url:"/admin/remove-pageelement-version",type:"post",data:{id:$(this).closest("li").attr("data-id")},success:function(a,b){if("OK"==a.status){var c=$(ElementSelector.currentElement).attr("data-id");$(".page-element").load("/admin/page-element-form",{id:c},timeoutHandler)}else timeoutHandler(a,b)},error:timeoutHandler}),!1):!1}),$(document).on("click",".app-version-item .remove",function(){return confirm("Do you really want to remove this snapshot?")?($.ajax({url:"/admin/remove-app-version",type:"post",data:{id:$(this).closest("li").attr("data-id")},success:function(){window.location.href="/cms"},error:timeoutHandler}),!1):!1})});;